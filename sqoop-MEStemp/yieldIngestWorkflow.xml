<workflow-app name="MEStemp-Ingest" xmlns="uri:oozie:workflow:0.1">

	<start to="Asset_Ingest"/>


    <action name="Asset_Ingest">
        <sqoop xmlns="uri:oozie:sqoop-action:0.2">
			<job-tracker>${jobTracker}</job-tracker>
            <name-node>${nameNode}</name-node>
			<configuration>
				<property>
					<name>oozie.hive.defaults</name>
					<value>/etc/hive/conf/hive-default.xml.template</value>
				</property>
			</configuration>
            <arg>--connect</arg>
            <arg>jdbc:sqlserver://172.23.236.90:1433;database=MEXICALI_OWNER</arg>
            <arg>--username</arg>
            <arg>app_MES_ReadOnlyUserMX</arg>
            <arg>--password</arg>
            <arg>X2{01_p7gyltm</arg>
            <arg>--query</arg>
            <arg>select AssetID, AssetName, RfAssetTypeID, LineID, MachineStageID, ToolID, GaugeID, PartID, InventoryPackID, LocationID, IsRetired, CostCentreID, ManufacturerID, SupplierID, AcquiredDT, PONumber, OrderedDT, ExpectedDeliveryDT, ExpectedFirstUseDT, EndUseDT, EndUseReason, PurchaseCost, DefaultLocationID, Comments,  1 as 'modcoID' from MES.Asset</arg>
            <arg>--num-mappers</arg>
            <arg>18</arg>
            <arg>--target-dir</arg>
            <arg>/MEStemp/Asset</arg>
        </sqoop>
        <ok to="BuildRecord_Ingest"/>
        <error to="end"/>
    </action>


    <action name="BuildRecord_Ingest">
        <sqoop xmlns="uri:oozie:sqoop-action:0.2">
			<job-tracker>${jobTracker}</job-tracker>
            <name-node>${nameNode}</name-node>
			<configuration>
				<property>
					<name>oozie.hive.defaults</name>
					<value>/etc/hive/conf/hive-default.xml.template</value>
				</property>
			</configuration>
            <arg>--connect</arg>
            <arg>jdbc:sqlserver://172.23.236.90:1433;database=MEXICALI_OWNER</arg>
            <arg>--username</arg>
            <arg>app_MES_ReadOnlyUserMX</arg>
            <arg>--password</arg>
            <arg>X2{01_p7gyltm</arg>
            <arg>--query</arg>
            <arg>select BuildRecordID, InvPackCreatedID, InvPackConsumedID, QuantityUsed, UnitID, BuildDT, IsEdited, RevisionNo, BuildMachineStageID,  1 as 'modcoID' from MES.BuildRecord</arg>
            <arg>--num-mappers</arg>
            <arg>18</arg>
            <arg>--target-dir</arg>
            <arg>/MEStemp/BuildRecord</arg>
        </sqoop>
        <ok to="end"/>
        <error to="end"/>
    </action>


	<end name="end"/>

</workflow-app>
